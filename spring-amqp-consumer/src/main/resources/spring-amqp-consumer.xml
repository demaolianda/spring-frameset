<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/jee
       http://www.springframework.org/schema/jee/spring-jee.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd
	   http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans.xsd">

    <import resource="classpath:spring-core.xml"/>
    <bean id="investerConsumer" class="wangzhongqiu.spring.amqp.InvesterConsumer" name="investerConsumer"/>
    <bean id="aotuConsumer" class="wangzhongqiu.spring.amqp.AotuConsumer" name="aotuConsumer"/>
    <!-- 连接配置 -->
    <rabbit:connection-factory id="mqConnectionFactory" host="${mq.host}"
                               username="${mq.username}"
                               password="${mq.password}"
                               port="${mq.port}"
                               virtual-host="${mq.vhost}"/>
    <rabbit:admin connection-factory="mqConnectionFactory"/>

    <!-- 消息对象json转换类 -->
    <bean id="jsonMessageConverter"
          class="org.springframework.amqp.support.converter.Jackson2JsonMessageConverter"/>

    <!--消息队列配置
      name="aa",name是消息队列的名称,发送消息时是无法直接指定发送到哪个队列中的
      auto-delete:队列使用完成自动删除
      durable：队列持久化
      exclusive：排他性,如果设置,其他用户看不见,但是此用户链接断开后，rabbitmq会删除此队列，无视是否持久化
     -->
    <rabbit:queue id="queue1" durable="true" auto-delete="false" name="aa" exclusive="false"/>
    <rabbit:queue id="queue2" durable="true" auto-delete="false" name="bb" exclusive="false"/>
    <rabbit:queue id="queue3" durable="true" auto-delete="false" name="cc" exclusive="false"/>
    <rabbit:queue id="queue4" durable="true" auto-delete="false" name="dd" exclusive="false"/>
    <rabbit:queue id="queue5" durable="true" auto-delete="false" name="ee" exclusive="false"/>
    <rabbit:queue id="queue6" durable="true" auto-delete="false" name="ff" exclusive="false"/>

    <!-- 消费者 监听配置-->
    <!-- The acknowledge mode: "auto", "manual", or "none".-->
    <!--多个listener监听同一个队列，会均匀分配给各个监听者，prefetchCount设置均匀分配的个数-->
    <!--concurrency设置的是对每个listener在初始化的时候设置的并发消费者的个数-->
    <!-- auto -->
    <rabbit:listener-container connection-factory="mqConnectionFactory"
                               acknowledge="auto" concurrency="1"
                               message-converter="jsonMessageConverter" prefetch="1">
        <!-- 一个监听器可以同时监听多个队列中的消息-->
        <rabbit:listener ref="aotuConsumer" queues="aa,bb,cc" method="onMessage"/>
    </rabbit:listener-container>
    <!-- manual -->
    <rabbit:listener-container connection-factory="mqConnectionFactory"
                               acknowledge="manual" concurrency="1"
                               message-converter="jsonMessageConverter" prefetch="1">
        <!-- 一个监听器可以同时监听多个队列中的消息-->
        <rabbit:listener ref="investerConsumer" queues="dd,ee,ff" method="onMessage"/>
    </rabbit:listener-container>
</beans>